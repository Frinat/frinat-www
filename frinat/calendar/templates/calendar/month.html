{% load calendar %}

<h1>Calendrier pour {{ date|date:"F Y" }}</h1>

{% if managed %}
<nav class="calendar-nav">
	<ul>
		{% with month.prev_period.start as prev %}
			<li><a href="{% calendar_month_url request.path prev.year prev.month %}">&larr; {{ prev|date:"F Y"|capfirst }}</a></li>
		{% endwith %}
		{% with month.next_period.start as next %}
			<li><a href="{% calendar_month_url request.path next.year next.month %}">{{ next|date:"F Y"|capfirst }} &rarr;</a></li>
		{% endwith %}
	</ul>
</nav>
{% endif %}

<table class="calendar">
	{% if weekday_names %}
	<thead>
		<tr>
			{% for day_name in weekday_names %}<th>{{ day_name|capfirst }}</th>{% endfor %}
		</tr>
	</thead>
	{% endif %}

	<tbody>
		{% for week in month.weeks %}
		<tr>
			{% for day in week.days %}
				{% ifnotequal day.start.month month.start.month %}
					<td class="empty"><span>{{day.start.day}}</span></td>
				{% else %}
					{% if day.has_events %}
						<td class="busy">
					{% else %}
						<td class="free">
					{% endif %}
						<span>{{day.start.day}}</span>
						{% if day.has_events %}
							<ul>
							{% for o in day.events %}
								{% ifequal forloop.counter 3 %}
									{% if not forloop.last  %}
										<li class="more">…</li>
									{% endif %}
								{% endifequal %}
								{% spaceless %}<li class="calendar-{{ o.event.calendar.pk }}">
									<a href="#">
										{% if o.event.isallday %}
											<!--<span>(All day) – </span>-->
										{% elif o.starts %}
											<span>{{ o.event.start|time:"G:i" }} – </span>
										{% elif o.contained %}
											<span>{{ o.event.start|time:"G:i" }} – </span>
										{% elif o.ends %}
											<span>{{ o.event.end|time:"G:i" }} (ends) – </span>
										{% endif %}
										{{ o.event.title }}
									</a>
								</li>{% endspaceless %}
							{% endfor %}
							</ul>
						{% endif %}
					</td>
				{% endifnotequal %}
			{% endfor %}
		</tr>
		{% endfor %}
	</tbody>
</table>

{% if managed %}
<nav class="calendar-nav">
	<ul>
		{% with month.prev_period.start as prev %}
			<li><a href="{% calendar_month_url request.path prev.year prev.month %}">&larr; {{ prev|date:"F Y"|capfirst }}</a></li>
		{% endwith %}
		{% with month.next_period.start as next %}
			<li><a href="{% calendar_month_url request.path next.year next.month %}">{{ next|date:"F Y"|capfirst }} &rarr;</a></li>
		{% endwith %}
	</ul>
</nav>
{% endif %}

<ul>
{% for o in month.events %}
	<li id="{{ o.event.id }}">
		<h2>{{ o.event.title }}</h2>
		<dl>
			<dt>Date</dt>
			<dd>{{ o.event.start|date:"d/m/Y" }}</dd>
			<dt>Time</dt>
			<dd>{{ o.event.start|time:"G:i" }}</dd>
		</dl>
		{{ o.event.location|default:'' }}
		{{ o.event.description|default:'' }}
	</li>
{% endfor %}
</ul>
